# Staggered PRF (äº¤é”™è„‰å†²é‡å¤é¢‘ç‡) æ–¹æ³•

<p align="center">
  <img src="../../docs/figures/staggered_prf_principle.png" alt="Staggered PRF Principle" width="700">
</p>

## ğŸ“– åŸç†ä»‹ç»

### ä»€ä¹ˆæ˜¯ Staggered PRFï¼Ÿ

**Staggered PRF**ï¼ˆäº¤é”™è„‰å†²é‡å¤é¢‘ç‡ï¼‰æ˜¯ä¸€ç§åœ¨é›·è¾¾ç³»ç»Ÿä¸­å¸¸ç”¨çš„æŠ—æ··å æŠ€æœ¯ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

> **ä½¿ç”¨ä¸¤ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰ä¸åŒçš„è„‰å†²é—´éš”äº¤æ›¿å‘å°„ï¼Œäº§ç”Ÿä¸¤ç»„å…·æœ‰ä¸åŒæ··å ç‰¹æ€§çš„æµ‹é‡å€¼ï¼Œé€šè¿‡è”åˆå¤„ç†æ¢å¤çœŸå®çš„å¤šæ™®å‹’é¢‘ç‡ã€‚**

### ä¸ºä»€ä¹ˆéœ€è¦ Staggered PRFï¼Ÿ

åœ¨è„‰å†²é›·è¾¾æˆ–FMCWé›·è¾¾ä¸­ï¼Œå¤šæ™®å‹’é¢‘ç‡çš„é‡‡æ ·ç‡ç”±**è„‰å†²é‡å¤é¢‘ç‡ (PRF)** å†³å®šï¼š

$$F_s = PRF = \frac{1}{T_{chirp}}$$

å½“ç›®æ ‡çš„å¤šæ™®å‹’é¢‘ç‡ $f_d$ è¶…è¿‡ Nyquist æé™ $\frac{PRF}{2}$ æ—¶ï¼Œä¼šå‘ç”Ÿ**é€Ÿåº¦æ¨¡ç³Š**ï¼ˆVelocity Ambiguityï¼‰ï¼š

$$f_{aliased} = ((f_d + \frac{PRF}{2}) \mod PRF) - \frac{PRF}{2}$$

### Staggered PRF å¦‚ä½•è§£å†³ï¼Ÿ

é€šè¿‡äº¤æ›¿ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„ chirp å‘¨æœŸ $T_1$ å’Œ $T_2$ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸¤ä¸ªä¸åŒçš„ç­‰æ•ˆé‡‡æ ·ç‡ï¼š

```
æ—¶åºå›¾:
   â”Œâ”€T1â”€â”    â”Œâ”€â”€â”€T2â”€â”€â”€â”    â”Œâ”€T1â”€â”    â”Œâ”€â”€â”€T2â”€â”€â”€â”
   â”‚    â”‚    â”‚        â”‚    â”‚    â”‚    â”‚        â”‚
â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€

Î”tâ‚ = T1ç»“æŸ â†’ T2ç»“æŸ = D + T2
Î”tâ‚‚ = T2ç»“æŸ â†’ T1ç»“æŸ = D + T1

ç­‰æ•ˆé‡‡æ ·ç‡:
Fsâ‚ = 1/Î”tâ‚
Fsâ‚‚ = 1/Î”tâ‚‚
```

å…³é”®æ´å¯Ÿï¼š**åŒä¸€ä¸ªçœŸå®é¢‘ç‡åœ¨ä¸¤ä¸ªé‡‡æ ·ç‡ä¸‹äº§ç”Ÿä¸åŒçš„æ··å é¢‘ç‡ï¼**

$$f_{alias,1} = ((f_{true} + \frac{Fs_1}{2}) \mod Fs_1) - \frac{Fs_1}{2}$$

$$f_{alias,2} = ((f_{true} + \frac{Fs_2}{2}) \mod Fs_2) - \frac{Fs_2}{2}$$

é€šè¿‡è”åˆæ±‚è§£è¿™ä¸¤ä¸ªæ–¹ç¨‹ï¼Œå¯ä»¥æ¢å¤å”¯ä¸€çš„ $f_{true}$ã€‚

---

## ğŸ§® æ•°å­¦æ¨å¯¼

### 1. æ··å æ˜ å°„å…³ç³»

è®¾çœŸå®é¢‘ç‡ä¸º $f$ï¼Œé‡‡æ ·ç‡ä¸º $F_s$ï¼Œåˆ™æ··å é¢‘ç‡ä¸ºï¼š

$$f_a = f - k \cdot F_s, \quad k = \text{round}(f / F_s)$$

è¿™ä½¿å¾— $f_a \in [-F_s/2, F_s/2]$ã€‚

### 2. åŒé‡‡æ ·ç‡è”åˆæ–¹ç¨‹

ç»™å®šä¸¤ä¸ªæµ‹é‡å€¼ $(f_{a1}, f_{a2})$ å’Œä¸¤ä¸ªé‡‡æ ·ç‡ $(F_{s1}, F_{s2})$ï¼ŒçœŸå®é¢‘ç‡æ»¡è¶³ï¼š

$$f = f_{a1} + k_1 \cdot F_{s1} = f_{a2} + k_2 \cdot F_{s2}$$

å…¶ä¸­ $k_1, k_2 \in \mathbb{Z}$ã€‚

### 3. å”¯ä¸€æ¢å¤èŒƒå›´

**å®šç†**ï¼šå¦‚æœ $\gcd(F_{s1}, F_{s2}) = \Delta$ï¼Œåˆ™çœŸå®é¢‘ç‡åœ¨ $[0, \text{lcm}(F_{s1}, F_{s2}))$ èŒƒå›´å†…**å”¯ä¸€ç¡®å®š**ã€‚

å¯¹äºäº’è´¨çš„é‡‡æ ·ç‡ï¼š$\text{lcm}(F_{s1}, F_{s2}) = F_{s1} \times F_{s2}$

### 4. æœç´¢ç®—æ³•

```matlab
% åœ¨å€™é€‰é¢‘ç‡èŒƒå›´å†…æœç´¢
for f_candidate = f_min : resolution : f_max
    fa1_expected = alias_freq(f_candidate, Fs1);
    fa2_expected = alias_freq(f_candidate, Fs2);
    
    if abs(fa1_expected - fa1_measured) < tol && ...
       abs(fa2_expected - fa2_measured) < tol
        f_recovered = f_candidate;
        break;
    end
end
```

---

## ğŸ“Š è®¾è®¡å‡†åˆ™

### é€‰æ‹© T1 å’Œ T2 çš„åŸåˆ™

1. **äº’è´¨æ€§**ï¼š$T_1$ å’Œ $T_2$ å¯¹åº”çš„é‡‡æ ·ç‡åº”å°½é‡äº’è´¨ï¼ˆæˆ–æ¥è¿‘äº’è´¨ï¼‰ï¼Œä»¥æœ€å¤§åŒ–å”¯ä¸€æ¢å¤èŒƒå›´

2. **å®é™…çº¦æŸ**ï¼š
   - ç¡¬ä»¶æ”¯æŒçš„chirpå‘¨æœŸèŒƒå›´
   - æµ‹è·èŒƒå›´éœ€æ±‚ï¼ˆchirpæŒç»­æ—¶é—´ï¼‰
   - å¸§ç‡éœ€æ±‚

3. **æ¨èé…ç½®**ï¼ˆé’ˆå¯¹FMCWé›·è¾¾EMGæ£€æµ‹ï¼‰ï¼š

| å‚æ•° | é…ç½®A | é…ç½®B | é…ç½®C |
|------|-------|-------|-------|
| T1 | 100 Î¼s | 127 Î¼s | 150 Î¼s |
| T2 | 150 Î¼s | 173 Î¼s | 200 Î¼s |
| D (delay) | 20 Î¼s | 20 Î¼s | 20 Î¼s |
| Fs1 | 5882 Hz | 5181 Hz | 4545 Hz |
| Fs2 | 8333 Hz | 6803 Hz | 5882 Hz |
| å”¯ä¸€èŒƒå›´ | ~24.5 kHz | ~17.6 kHz | ~13.4 kHz |

### ADF4159 Dual-Slope æ¨¡å¼é…ç½®

ADF4159 é¢‘ç‡åˆæˆå™¨æ”¯æŒ **Dual Sawtooth** æ¨¡å¼ï¼Œéå¸¸é€‚åˆå®ç° Staggered PRFï¼š

```
Registeré…ç½®:
- DEV_SEL = 0: T1 = RAMP_CLK Ã— STEP (Slope 1)
- DEV_SEL = 1: T2 = RAMP_CLK Ã— STEP (Slope 2)
- DELAY: ä¸¤ä¸ªslopeä¹‹é—´çš„å»¶è¿Ÿ
```

---

## ğŸ’» ä»£ç æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `staggered_prf_basic_demo.m` | åŸºç¡€åŸç†æ¼”ç¤ºï¼šåŒé‡‡æ ·ç‡æ··å å’Œæ¢å¤ |
| `staggered_prf_fmcw_demo.m` | FMCWé›·è¾¾åº”ç”¨ï¼šå®Œæ•´çš„EMGä¿¡å·æ£€æµ‹ä»¿çœŸ |
| `staggered_prf_crt_solver.m` | CRTæœç´¢æ±‚è§£å™¨å‡½æ•° |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

```matlab
% 1. è¿è¡ŒåŸºç¡€æ¼”ç¤º
cd methods/03_staggered_prf
staggered_prf_basic_demo

% 2. è¿è¡ŒFMCWé›·è¾¾åº”ç”¨æ¼”ç¤º
staggered_prf_fmcw_demo
```

---

## ğŸ“ˆ å…¸å‹ç»“æœ

### æ··å æ¨¡å¼å¯è§†åŒ–

```
çœŸå®é¢‘ç‡: 5000 Hz
Fs1 = 5882 Hz â†’ æ··å åˆ°: -882 Hz
Fs2 = 8333 Hz â†’ æ··å åˆ°:  833 Hz

æœç´¢ç®—æ³•:
  åœ¨0-25kHzèŒƒå›´å†…ï¼Œå”¯ä¸€æ»¡è¶³ (-882, 833) å¯¹çš„é¢‘ç‡ = 5000 Hz âœ“
```

### æ€§èƒ½æŒ‡æ ‡ï¼ˆä»¿çœŸç»“æœï¼‰

| SNR | é¢‘ç‡ä¼°è®¡RMSE | æˆåŠŸç‡ |
|-----|-------------|--------|
| 20 dB | < 5 Hz | > 99% |
| 10 dB | < 20 Hz | > 95% |
| 5 dB | < 50 Hz | > 85% |

---

## ğŸ”— ç›¸å…³æ–¹æ³•

- **[CRT Multi-rate](../02_crt_multirate/)**: ä½¿ç”¨ä¸­å›½å‰©ä½™å®šç†çš„æ•°å­¦ç­‰ä»·æ–¹æ³•
- **[Non-uniform Sampling](../04_nonuniform_sampling/)**: åˆ©ç”¨éè§„åˆ™é‡‡æ ·æ—¶åˆ»
- **[Parametric Methods](../06_parametric_methods/)**: MUSIC/ESPRITç”¨äºå¤šç›®æ ‡åœºæ™¯

---

## ğŸ“š å‚è€ƒæ–‡çŒ®

1. M. A. Richards, "Fundamentals of Radar Signal Processing", McGraw-Hill, 2014
2. S. Kingsley and S. Quegan, "Understanding Radar Systems", SciTech Publishing, 1999
3. ADF4159 Datasheet, Analog Devices

---

## ğŸ“ æ›´æ–°æ—¥å¿—

- **v1.0** (2024-01): åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºç¡€Staggered PRFå®ç°
- **v1.1** (2024-01): æ·»åŠ FMCWé›·è¾¾EMGæ£€æµ‹åº”ç”¨
